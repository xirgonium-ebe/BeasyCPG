<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Alfresco Generator – Model / Forms / DynLists</title>
  <link rel="stylesheet" href="styles.css" />
  <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
</head>
<body>
  <header class="app-header">
    <h1>Alfresco/beCPG – Générateur de balises & imports</h1>
    <div class="header-actions">
      <button id="btnExportJSON" class="btn">Exporter projet (.json)</button>
      <label class="file-label">
        Importer projet (.json)
        <input type="file" id="fileImportJSON" accept=".json" />
      </label>
      <button id="btnReset" class="btn btn-danger">Réinitialiser</button>
    </div>
  </header>

  <nav class="tabs">
    <button data-tab="project" class="tab active">Projet</button>
    <button data-tab="properties" class="tab">Propriétés</button>
    <button data-tab="assocs" class="tab">Associations</button>
    <button data-tab="dynlists" class="tab">DynLists</button>
    <button data-tab="preview" class="tab">Aperçu & Export</button>
  </nav>

  <main>
    <!-- PROJECT -->
    <section id="tab-project" class="panel active">
      <form id="formProject" class="form-grid">
        <fieldset>
          <legend>Infos projet</legend>
          <label>Nom du projet
            <input name="projectName" placeholder="ex: Adisseo Labeling" />
          </label>
          <label>Namespace prefix
            <input name="nsPrefix" placeholder="ex: brn" />
          </label>
          <label>Namespace URI
            <input name="nsUri" placeholder="ex: http://example.com/brn/1.0" />
          </label>
        </fieldset>

        <fieldset>
          <legend>Paramètres généraux</legend>
          <div class="grid-3">
            <label>QName contrainte DynList
              <input name="dynQName" value="fr.becpg.repo.dictionary.constraint.DynListConstraint" />
            </label>
            <label>Nom du paramètre “path”
              <input name="dynPathParam" value="path" />
            </label>
            <label>Locale par défaut
              <input name="defaultLocale" value="fr" />
            </label>
          </div>
          <div class="inline">
            <label class="check"><input type="checkbox" name="includeContainers" checked />
              Inclure &lt;properties&gt; / &lt;associations&gt; / &lt;constraints&gt;</label>
            <label class="check"><input type="checkbox" name="showForce" />
              Ajouter force="true" sur &lt;show&gt;</label>
            <label class="check"><input type="checkbox" name="showForMode" />
              Ajouter for-mode="true" sur &lt;show&gt;</label>
          </div>
        </fieldset>

        <fieldset>
          <legend>Conteneurs & Sets</legend>
          <div class="inline">
            <label class="check"><input type="checkbox" name="containerProperties" checked /> Générer des propriétés</label>
            <label class="check"><input type="checkbox" name="containerAssociations" checked /> Générer des associations</label>
          </div>
          <div>
            <label>Sets disponibles (pour l’attribut set des &lt;field&gt;)</label>
            <div class="inline">
              <input name="newFieldSet" placeholder="ex: referentialData" />
              <button type="button" id="btnAddFieldSet" class="btn">Ajouter set</button>
            </div>
            <p class="small-muted">Ces sets seront proposés dans les formulaires Propriété/Association.</p>
          </div>
          <ul id="ulFieldSets" class="small-muted"></ul>
        </fieldset>

        <div class="row-actions">
          <button type="submit" class="btn btn-primary">Enregistrer</button>
        </div>
      </form>
    </section>

    <!-- PROPERTIES -->
    <section id="tab-properties" class="panel">
      <form id="formProperty" class="form-grid">
        <fieldset>
          <legend><span id="propFormLegend">Nouvelle propriété</span></legend>
          <div class="grid-3">
            <label>Nom technique (local)
              <input name="qnameLocal" placeholder="ex: go1Decision" required />
            </label>
            <label>Title (libellé)
              <input name="title" placeholder="ex: Décision GO1" />
            </label>
            <label>Type (Alfresco)
              <select name="type">
                <option>d:text</option>
                <option>d:mltext</option>
                <option>d:int</option>
                <option>d:long</option>
                <option>d:double</option>
                <option>d:boolean</option>
                <option>d:date</option>
                <option>d:datetime</option>
                <option>d:content</option>
                <option>d:nodeRef</option>
              </select>
            </label>
          </div>

          <div class="grid-3">
            <label class="check"><input type="checkbox" name="multiple" /> Multiple</label>
            <label>Valeur par défaut
              <input name="default" />
            </label>
            <label>Label ID (optionnel)
              <input name="labelId" placeholder="ex: becpg.forms.field.tradeName" />
            </label>
          </div>

          <div class="grid-3">
            <label class="check"><input type="checkbox" name="mandatoryModel" /> Mandatory (modèle)</label>
            <label class="check"><input type="checkbox" name="mandatoryForm" /> Mandatory (form)</label>
            <label class="check"><input type="checkbox" name="readOnlyForm" /> Read-only (form)</label>
          </div>

          <div class="grid-3">
            <label>Field set (attribut set=…)
              <select name="fieldSet"></select>
            </label>
            <label>Contrôle de field
              <select name="fieldControl">
                <option value="auto">Auto (par type)</option>
                <option value="textfield">Texte (textfield.ftl)</option>
                <option value="textarea">Texte long (textarea.ftl)</option>
                <option value="assoc-auto">Association (autocomplete-association.ftl)</option>
                <option value="noderef-auto">NodeRef / Hiérarchie (autocomplete.ftl)</option>
              </select>
            </label>
            <label>Max length (si textfield)
              <input name="maxLength" type="number" min="0" placeholder="ex: 40" />
            </label>
          </div>

          <div id="propAssocOptions" class="grid-3" style="display:none">
            <label>Datasource (ds)
              <input name="assocDs" placeholder="becpg/autocomplete/targetassoc/associations/..." />
            </label>
            <label>pageLinkTemplate (optionnel)
              <input name="assocPageLinkTemplate" placeholder="entity-data-lists?list=...&amp;nodeRef={nodeRef}" />
            </label>
            <div></div>
          </div>

          <div id="propNodeRefOptions" class="grid-3" style="display:none">
            <label>Datasource (ds)
              <input name="nrDs" placeholder="becpg/autocomplete/linkedvalue/values/System/..." />
            </label>
            <label>Niveaux de hiérarchie (>=1)
              <input name="nrLevels" type="number" min="1" value="1" />
            </label>
            <div></div>
          </div>
        </fieldset>

        <fieldset>
          <legend>Contrainte DynList (beCPG)</legend>
          <div class="grid-3">
            <label>Nom de la contrainte
              <input name="constraintName" placeholder="ex: brn:goDecisionList" />
            </label>
            <label>Path (cm:... de la liste)
              <input name="dynPath" placeholder="/System/Lists/bcpg:entityLists/ma_liste" />
            </label>
            <label>DynList du projet
              <select name="linkDynList">
                <option value="">— aucune —</option>
              </select>
            </label>
          </div>
          <div class="inline">
            <button type="button" id="btnCreateDynFromProp" class="btn">+ Créer DynList depuis cette propriété</button>
          </div>
          <p class="small-muted">La contrainte générée fixe constraintType=bcpg:listValue, constraintProp=bcpg:lvValue, addEmptyValue=true (seuls name et path sont éditables).</p>
        </fieldset>

        <div class="row-actions">
          <button type="submit" class="btn btn-primary" id="btnSaveProp">Ajouter propriété</button>
          <button type="button" class="btn" id="btnCancelProp" style="display:none">Annuler</button>
        </div>
      </form>

      <div class="list">
        <h3>Propriétés</h3>
        <table id="tblProperties" class="table">
          <thead>
            <tr>
              <th>QName</th><th>Title</th><th>Type</th><th>Multi</th><th>Mand(M)</th><th>Mand(F)</th><th>RO(F)</th><th>Constraint</th><th>Field set</th><th></th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <!-- ASSOCIATIONS -->
    <section id="tab-assocs" class="panel">
      <form id="formAssoc" class="form-grid">
        <fieldset>
          <legend><span id="assocFormLegend">Nouvelle association</span></legend>
          <div class="grid-3">
            <label>Nom technique (local)
              <input name="qnameLocal" placeholder="ex: actorProjectLeader" required />
            </label>
            <label>Title
              <input name="title" placeholder="ex: Project Leader" />
            </label>
            <label>Classe cible
              <input name="targetClass" value="cm:person" />
            </label>
          </div>
          <div class="grid-3">
            <label class="check"><input type="checkbox" name="mandatoryModel" /> Mandatory (modèle)</label>
            <label class="check"><input type="checkbox" name="mandatoryForm" /> Mandatory (form)</label>
            <label>Field set
              <select name="fieldSet"></select>
            </label>
          </div>
          <div class="grid-3">
            <label>Source many
              <select name="sourceMany">
                <option value="true" selected>true</option>
                <option value="false">false</option>
              </select>
            </label>
            <label>Target many
              <select name="targetMany">
                <option value="false" selected>false</option>
                <option value="true">true</option>
              </select>
            </label>
            <div></div>
          </div>

          <fieldset>
            <legend>Contrôle (association)</legend>
            <div class="grid-3">
              <label>Datasource (ds)
                <input name="assocDs" placeholder="becpg/autocomplete/targetassoc/associations/..." />
              </label>
              <label>pageLinkTemplate (optionnel)
                <input name="assocPageLinkTemplate" placeholder="entity-data-lists?list=...&amp;nodeRef={nodeRef}" />
              </label>
              <div></div>
            </div>
          </fieldset>
        </fieldset>

        <div class="row-actions">
          <button type="submit" class="btn btn-primary" id="btnSaveAssoc">Ajouter association</button>
          <button type="button" class="btn" id="btnCancelAssoc" style="display:none">Annuler</button>
        </div>
      </form>

      <div class="list">
        <h3>Associations</h3>
        <table id="tblAssocs" class="table">
          <thead>
            <tr>
              <th>QName</th><th>Title</th><th>Target</th><th>S-many</th><th>T-many</th><th>Mand(M)</th><th>Mand(F)</th><th>Field set</th><th></th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <!-- DYNLISTS -->
    <section id="tab-dynlists" class="panel">
      <form id="formDyn" class="form-grid">
        <fieldset>
          <legend><span id="dynFormLegend">Nouvelle DynList</span></legend>
          <div class="grid-3">
            <label>Nom logique de la liste
              <input name="listName" placeholder="ex: brn_goDecision" required />
            </label>
            <label>Path (cm:... dans /System/Lists/…)
              <input name="listPath" placeholder="/System/Lists/bcpg:entityLists/brn_goDecision" required />
            </label>
            <div></div>
          </div>

          <label>Coller vos lignes — format strict : <code>code:value</code> (une ligne par entrée)
            <textarea name="pasted" rows="8" placeholder="GO:GO
NO_GO:NO GO"></textarea>
          </label>

          <div class="row-actions">
            <button type="button" id="btnParseDyn" class="btn">Analyser</button>
          </div>

          <fieldset>
            <legend>Ajout inline</legend>
            <div class="grid-3">
              <label>code <input name="il_code" /></label>
              <label>value <input name="il_value" /></label>
              <div></div>
            </div>
            <div class="row-actions">
              <button type="button" id="btnInlineAdd" class="btn">+ Ajouter une ligne</button>
            </div>
          </fieldset>

          <div class="row-actions">
            <button type="submit" class="btn btn-primary" id="btnSaveDyn">Ajouter DynList</button>
            <button type="button" class="btn" id="btnCancelDyn" style="display:none">Annuler</button>
          </div>
        </fieldset>
      </form>

      <div class="list">
        <h3>DynLists</h3>
        <table id="tblDyn" class="table">
          <thead>
            <tr>
              <th>Nom</th><th>Path</th><th>Entrées</th><th></th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <!-- PREVIEW -->
    <section id="tab-preview" class="panel">
      <div class="preview-grid">
        <div class="preview-block">
          <div class="block-head">
            <h3>Fragment modèle – &lt;properties&gt;</h3>
            <button class="btn btn-copy" data-copy="#outProps">Copier</button>
          </div>
          <textarea id="outProps" rows="12" readonly></textarea>
        </div>

        <div class="preview-block">
          <div class="block-head">
            <h3>Fragment modèle – &lt;associations&gt;</h3>
            <button class="btn btn-copy" data-copy="#outAssocs">Copier</button>
          </div>
          <textarea id="outAssocs" rows="12" readonly></textarea>
        </div>

        <div class="preview-block">
          <div class="block-head">
            <h3>Fragment modèle – &lt;constraints&gt;</h3>
            <button class="btn btn-copy" data-copy="#outConstraints">Copier</button>
          </div>
          <textarea id="outConstraints" rows="12" readonly></textarea>
        </div>

        <div class="preview-block">
          <div class="block-head">
            <h3>Share – &lt;show&gt;</h3>
            <button class="btn btn-copy" data-copy="#outShow">Copier</button>
          </div>
          <textarea id="outShow" rows="10" readonly></textarea>
        </div>

        <div class="preview-block">
          <div class="block-head">
            <h3>Share – &lt;field&gt;</h3>
            <button class="btn btn-copy" data-copy="#outField">Copier</button>
          </div>
          <textarea id="outField" rows="16" readonly></textarea>
        </div>
      </div>

      <div class="export-actions">
        <button id="btnBuild" class="btn btn-primary">Construire fragments</button>
        <button id="btnDownloadZip" class="btn">Télécharger ZIP</button>
      </div>
    </section>
  </main>

  <footer class="app-footer">
    <small>Made for Alfresco/beCPG · 100% client-side</small>
  </footer>

  <script src="app.js"></script>
</body>
</html>
